<!-- explorer/templates/explorer/details.html -->

{% extends "explorer/base.html" %}
{% load static %}
{% block content %}
{% load custom_filters %}

<script src="{% static 'explorer/details.js' %}"></script>

<section class="vf-content | vf-stack vf-stack--600">
    <h2> MGnifam: {{ family_id }} </h2>
    <h3> Family size: {{ family_size }} </h3>
    <h3> Protein representative: <a href="http://proteins.mgnify.org/{{ protein_rep }}" target="_blank">{{ protein_rep }}</a></h3>
    <h4> Mask: {{ mask }} </h4>

    <article class="vf-card vf-card--brand vf-card--bordered">
        <div class="vf-grid vf-grid__col-4 | vf-card__content">
            <div class="vf-grid__col--span-1">
                <h3>ESM Atlas 3D structure</h3>
                <p>
                    Predicted 3D protein structure through the Meta AI ESMFold model.
                    ESMFold uses the representations from a large language model (ESM2)
                    to generate an accurate structure prediction from the sequence of a protein.
                </p>
                <p>
                    For more information visit:
                    <ul class="vf-list">
                        <li class="vf-list__item">
                            <a href="https://esmatlas.com/" target="_blank" class="vf-link ext">ESM Metagenomic Atlas</a>
                        </li>
                        <li class="vf-list__item">
                            <a href="https://www.science.org/doi/full/10.1126/science.ade2574"
                               target="_blank"
                               class="vf-link ext">
                                Evolutionary-scale prediction of atomic-level protein structure with a language model
                            </a>
                        </li>
                    </ul>
                </p>
            </div>
            <div class="vf-grid__col--span-3">
                <div id="pdb_viewer">
                    <pdbe-molstar
                        custom-data-url="{% static "cif/"|add:cif_path %}"
                        custom-data-format="cif"
                        alphafold-view="true"
                        bg-color-r="255"
                        bg-color-g="255"
                        bg-color-b="255"
                        sequence-panel="true"
                        landscape="true"
                    >
                    </pdbe-molstar>
                </div>
            </div>
        </div>
    </article>

    <article class="vf-card vf-card--brand vf-card--bordered">
        <div class="vf-card__content | vf-stack vf-stack--400">
            <h3 class="vf-card__heading">Pfam model hits</h3>
            <table id="pfams-table"
                       class="vf-table pfams-table .vf-u-margin__bottom--400">
                <thead class="vf-table__header">
                    <tr class="vf-table__row">
                        <th class="vf-table__heading" scope="col">No</th>
                        <th class="vf-table__heading" scope="col">Pfam hit</th>
                        <th class="vf-table__heading" scope="col">E-value</th>
                        <th class="vf-table__heading" scope="col">Query HMM</th>
                        <th class="vf-table__heading" scope="col">Template HMM</th>
                    </tr>
                </thead>
                <tbody class="vf-table__body">
                    {% for hit in hits_data %}
                        <tr class="vf-table__row pfam-item" data-proteinpfam="{{ hit.pfam_id }}">
                            <td class="vf-table__cell">{{ hit.rank }}</td>
                            <td class="vf-table__cell">
                                <a href="https://www.ebi.ac.uk/interpro/entry/pfam/{{ hit.pfam_id }}"
                                   target="_blank">{{ hit.name }}</a>
                            </td>
                            <td class="vf-table__cell">{{ hit.e_value }}</td>
                            <td class="vf-table__cell">{{ hit.query_hmm }}</td>
                            <td class="vf-table__cell">{{ hit.template_hmm }}</td>                            
                        </tr>
                    {% empty %}
                        <tr class="vf-table__heading">
                            <td class="vf-table__cell" colspan="5">No Pfam hits</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </article>

</section>

<script src="https://cdn.jsdelivr.net/npm/babel-polyfill/dist/polyfill.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs/webcomponents-lite.js" charset="utf-8"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs/custom-elements-es5-adapter.js" charset="utf-8"></script>
<script type="text/javascript" src="https://www.ebi.ac.uk/pdbe/pdb-component-library/js/pdbe-molstar-component-3.1.0.js"></script>

{% endblock %}
